<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ثبت سفارش | ERiSH Carpet</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="logo">🧵 ERiSH Carpet</div>
    <nav>
      <a href="index.html">خانه</a>
      <a href="products.html">محصولات</a>
      <a href="offers.html">تخفیف‌ها</a>
      <a href="stats.html">آمار</a>
      <a href="dashboard.html">مدیریت</a>
      <a href="contact.html">تماس</a>
    </nav>
  </header>

  <div class="form-box fade-in">
    <h2>فرم ثبت سفارش</h2>
    <form id="orderForm">
      <label>نام و نام خانوادگی:</label>
      <input type="text" id="name" required>

      <label>شماره تماس:</label>
      <input type="text" id="phone" required>

      <label>آدرس:</label>
      <textarea id="address" rows="3" required></textarea>

      <label>طرح انتخابی:</label>
      <input type="text" id="product" placeholder="مثلاً فرشینه مدرن 1" required>

      <label>اندازه (متر مربع):</label>
      <input type="number" id="size" placeholder="مثلاً 4" required>

      <div class="price-box">قیمت کل: <span id="price">0</span> تومان</div>

      <label>توضیحات اضافی:</label>
      <textarea id="notes" rows="2"></textarea>

      <button type="submit" class="btn">ثبت سفارش ✅</button>
      <div class="success" id="successMsg">سفارش شما با موفقیت ثبت شد 🌿</div>
    </form>
  </div>

  <footer>
    © 2025 ERiSH Carpet — تمامی حقوق محفوظ است 🌿
  </footer>

  <script>
    const PRICE_PER_METER = 600000;

    document.getElementById("size").addEventListener("input", function() {
      const size = parseFloat(this.value) || 0;
      document.getElementById("price").innerText = (size * PRICE_PER_METER).toLocaleString("fa-IR");
    });

    document.getElementById("orderForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const order = {
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        address: document.getElementById("address").value,
        product: document.getElementById("product").value,
        size: parseFloat(document.getElementById("size").value),
        notes: document.getElementById("notes").value,
        status: "در حال بررسی",
        date: new Date().toLocaleString()
      };

      const orders = JSON.parse(localStorage.getItem("orders") || "[]");
      orders.push(order);
      localStorage.setItem("orders", JSON.stringify(orders));

      // 🔔 اعلان برای مدیر
      localStorage.setItem("orders", JSON.stringify(orders));
      window.dispatchEvent(new Event("storage"));

      // 🟢 ارسال مستقیم به واتساپ
      const whatsappNumber = "989229289822"; // شماره شما بدون صفر
      const msg = `🧵 سفارش جدید ERiSH Carpet
👤 نام: ${order.name}
📞 شماره: ${order.phone}
📍 آدرس: ${order.address}
🎨 طرح: ${order.product}
📏 اندازه: ${order.size} متر
💰 قیمت: ${(order.size * PRICE_PER_METER).toLocaleString("fa-IR")} تومان
🕒 تاریخ: ${order.date}`;

      window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`);

      // ✅ نمایش پیام موفقیت
      document.getElementById("successMsg").style.display = "block";
      document.getElementById("orderForm").reset();
      document.getElementById("price").innerText = "0";

      setTimeout(() => document.getElementById("successMsg").style.display = "none", 4000);
    });
  </script>
</body>
</html>